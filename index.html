<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SecCoach – Quiz szkoleniowy</title>

  <meta name="description" content="SecCoach – interaktywny quiz z cyberbezpieczeństwa dla pracowników.">
  <link rel="icon" type="image/png" href="assets/logo-seccoach.png">

  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --accent:#38bdf8; --accent-2:#34d399; --danger:#f43f5e;
      --card:#0b1220; --border:#1f2937; --shadow:0 10px 25px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,sans-serif}
    body.no-scroll{overflow:hidden}

    /* Header + nav */
    .site-header{
      position:sticky;top:0;z-index:1000;display:flex;align-items:center;justify-content:space-between;
      padding:10px 16px;background:rgba(15,23,42,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)
    }
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:48px;display:block}
    nav{display:flex;gap:10px;flex-wrap:wrap}
    .nav-btn{
      border:1px solid var(--border);background:var(--card);color:var(--text);
      border-radius:10px;padding:8px 12px;cursor:pointer;font-weight:600
    }
    .nav-btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1220;border:none}

    .container{max-width:960px;margin:0 auto;padding:0 20px 40px}
    .panel{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-top:20px}
    .row{margin:10px 0;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{min-width:180px;color:var(--muted)}
    select,input,button{border:1px solid var(--border);background:var(--card);color:var(--text);border-radius:10px;padding:10px 12px;font-size:15px}
    input:invalid{border-color:var(--danger)} input:valid{border-color:#334155}
    button{transition:background .2s,border-color .2s,transform .1s} button:active{transform:scale(.98)}
    .pill{padding:3px 10px;border-radius:999px;background:#0b1220;border:1px solid var(--border);font-size:13px;color:var(--muted)}
    .bar{height:8px;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:.3s;border-radius:8px}
    .answers{display:grid;gap:8px;margin:10px 0}
    .option{padding:12px;border:1px solid var(--border);border-radius:12px;background:#0e1627;text-align:left}
    .option.correct{border-color:var(--accent-2);background:rgba(52,211,153,.1)}
    .option.wrong{border-color:var(--danger);background:rgba(244,63,94,.1)}
    .dots{display:flex;justify-content:center;gap:6px;margin-bottom:8px;flex-wrap:wrap}
    .dot{width:10px;height:10px;border-radius:50%;background:#1f2937;cursor:pointer}
    .dot.active{background:var(--accent)}
    #timer{font-weight:700;color:var(--accent);text-align:center;margin-top:5px}
    .site-footer{max-width:960px;margin:24px auto;padding:0 20px;color:var(--muted);text-align:center}

    /* Blok obrazka do pytania */
    .q-img{width:100%;height:clamp(160px,28vw,260px);border:1px dashed var(--border);border-radius:14px;display:grid;place-items:center;color:var(--muted);background:#0b1220;overflow:hidden;margin:10px 0 14px}
    .q-img img{width:100%;height:100%;object-fit:cover;display:none}
    .q-img figcaption{font-size:13px;color:var(--muted);padding:6px}

    /* Modal (instalacja + lekcje) */
    .modal{
      position:fixed; inset:0; z-index:5000;
      background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; padding:20px
    }
    .modal.show{display:flex}
    .modal-content{
      background:var(--panel); border:1px solid var(--border); color:var(--text);
      border-radius:16px; padding:22px; max-width:720px; width:100%;
      max-height:90vh; overflow:auto; box-shadow:var(--shadow);
    }
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .progress-wrap{height:14px;background:#1e293b;border-radius:10px;margin:14px 0}
    .progress{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:10px;transition:width .2s}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="brand">
      <img src="assets/logo-seccoach.png" alt="SecCoach – logo"/>
      <span class="pill">SecCoach</span>
    </div>
    <nav>
      <button id="navAbout" class="nav-btn">O nas</button>
      <button id="navServices" class="nav-btn">Usługi</button>
      <button id="navContact" class="nav-btn">Kontakt</button>
    </nav>
  </header>

  <main class="container">
    <!-- USTAWIENIA QUIZU -->
    <section class="panel" id="settings">
      <h2>Ustawienia quizu</h2>
      <div class="row">
        <label for="playerEmail">E-mail firmowy:</label>
        <input id="playerEmail" type="email" placeholder="imie.nazwisko@firma.pl" required>
      </div>
      <div class="row">
        <label for="category">Kategoria:</label>
        <select id="category">
          <option value="latwe">Łatwe</option>
          <option value="srednie">Średnie</option>
          <option value="trudne">Zaawansowane</option>
          <option value="mix">Miks</option>
        </select>
      </div>
      <div class="row">
        <label for="count">Liczba pytań:</label>
        <input id="count" type="number" min="1" max="10" value="10">
      </div>
      <div class="row">
        <button id="startBtn" class="nav-btn primary" disabled>Rozpocznij quiz</button>
      </div>
      <small style="color:var(--muted)">Pytania wczytywane są z pliku <code>assets/questions.json</code>. Dane wyników są zapisywane lokalnie (localStorage).</small>
    </section>

    <!-- QUIZ -->
    <section class="panel" id="quiz" style="display:none;">
      <div id="timer">Czas: 03:00</div>
      <div class="dots" id="dots" aria-label="Nawigacja po pytaniach"></div>
      <div class="pill">Pytanie <span id="qIndex">0</span>/<span id="qTotal">0</span></div>
      <div class="bar" id="bar" aria-hidden="true"></div>

      <figure class="q-img" id="qImageBox">
        <img id="qImage" alt="Obraz ilustrujący pytanie"/>
        <figcaption id="qImageCap">Miejsce na grafikę (opcjonalnie)</figcaption>
      </figure>

      <h3 id="qText"></h3>
      <div id="answers" class="answers"></div>
      <div id="explanation" style="color:var(--muted);font-size:14px;margin-top:6px;"></div>

      <div class="row">
        <button id="prevBtn" class="nav-btn">Wstecz</button>
        <button id="nextBtn" class="nav-btn primary">Dalej</button>
      </div>
    </section>

    <!-- WYNIK -->
    <section class="panel" id="result" style="display:none;">
      <h2>Wynik</h2>
      <div id="score"></div>
      <div class="row" style="gap:8px;flex-wrap:wrap;">
        <button id="retryBtn" class="nav-btn primary">Zagraj ponownie</button>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <small>© 2025 SecCoach • Wersja 2.32 • Projekt wykonany na Uniwersytecie WSB Merito w Bydgoszczy</small>
  </footer>

  <!-- ===== MODAL: SYMULACJA INSTALACJI (po wejściu) ===== -->
  <div id="fakeInstall" class="modal" aria-modal="true" role="dialog" aria-labelledby="installTitle">
    <div class="modal-content" style="max-width:440px;text-align:center;">
      <h3 id="installTitle">Pobieranie zabezpieczeń systemu...</h3>
      <div class="progress-wrap"><div id="progressBar" class="progress"></div></div>
      <p id="installMsg" style="color:var(--muted);font-size:14px;">Proszę nie zamykać okna.</p>
    </div>
  </div>

  <!-- ===== MODAL: O NAS (lekcja) ===== -->
  <div id="modalAbout" class="modal" aria-modal="true" role="dialog" aria-labelledby="aboutTitle">
    <div class="modal-content">
      <h3 id="aboutTitle">O nas – co trenować w cyberbezpieczeństwie?</h3>
      <p><strong>Najczęstszy wektor ataku to człowiek</strong>, nie technologia. Dlatego szkolimy w rozpoznawaniu socjotechniki i nawykach higieny cyfrowej.</p>
      <ul>
        <li>Weryfikuj nadawcę wiadomości i domenę e-mail.</li>
        <li>Nie klikaj pochopnie: najedź kursorem na link i sprawdź adres.</li>
        <li>Używaj menedżera haseł i włącz 2FA/MFA.</li>
        <li>Aktualizuj system i aplikacje – łatki bezpieczeństwa mają znaczenie.</li>
      </ul>
      <div class="actions"><button data-close="#modalAbout" class="nav-btn primary">Rozumiem</button></div>
    </div>
  </div>

  <!-- ===== MODAL: USŁUGI (lekcja) ===== -->
  <div id="modalServices" class="modal" aria-modal="true" role="dialog" aria-labelledby="servicesTitle">
    <div class="modal-content">
      <h3 id="servicesTitle">Usługi – jak ocenić podejrzaną stronę?</h3>
      <ol>
        <li><strong>Kłódka ≠ zaufanie.</strong> Certyfikat SSL tylko szyfruje – nie potwierdza uczciwości.</li>
        <li><strong>Adres URL.</strong> Literówki i subdomeny to klasyczny phishing (np. <em>micros0ft-secure.com</em>).</li>
        <li><strong>Żądania poświadczeń.</strong> Gdy „serwis” nagle wymaga logowania – bądź czujny.</li>
        <li><strong>Brak polityk / kontaktu.</strong> Brak podstawowych informacji – sygnał ostrzegawczy.</li>
      </ol>
      <div class="actions"><button data-close="#modalServices" class="nav-btn primary">OK</button></div>
    </div>
  </div>

  <!-- ===== MODAL: KONTAKT (lekcja) ===== -->
  <div id="modalContact" class="modal" aria-modal="true" role="dialog" aria-labelledby="contactTitle">
    <div class="modal-content">
      <h3 id="contactTitle">Kontakt – jak odpowiadać na „pilne” prośby?</h3>
      <p>Ataki „na prezesa” (Business Email Compromise) budują presję czasu. Zanim wyślesz dane lub przelew:</p>
      <ul>
        <li>Oddzwoń na <em>znany</em> numer z książki telefonicznej.</li>
        <li>Wymagaj drugiego zatwierdzenia (zasada 4-oczu).</li>
        <li>Nie wysyłaj skanów dokumentów kanałem e-mail bez szyfrowania.</li>
      </ul>
      <div class="actions"><button data-close="#modalContact" class="nav-btn primary">Jasne</button></div>
    </div>
  </div>

  <script>
    /* ======= Minimalna logika quizu (bez „toastów”) ======= */
    let questions = { latwe:[], srednie:[], trudne:[] };
    let state = { pool: [], current: 0, answers: [], timer: 180 };
    let timerInterval;

    const els = {
      playerEmail: document.getElementById('playerEmail'),
      category: document.getElementById('category'),
      count: document.getElementById('count'),
      startBtn: document.getElementById('startBtn'),
      settings: document.getElementById('settings'),
      quiz: document.getElementById('quiz'),
      result: document.getElementById('result'),
      qText: document.getElementById('qText'),
      answers: document.getElementById('answers'),
      qIndex: document.getElementById('qIndex'),
      qTotal: document.getElementById('qTotal'),
      bar: document.getElementById('bar'),
      nextBtn: document.getElementById('nextBtn'),
      prevBtn: document.getElementById('prevBtn'),
      explanation: document.getElementById('explanation'),
      score: document.getElementById('score'),
      retryBtn: document.getElementById('retryBtn'),
      timer: document.getElementById('timer'),
      dots: document.getElementById('dots'),
      qImage: document.getElementById('qImage'),
      qImageCap: document.getElementById('qImageCap'),
      // nav modals
      navAbout: document.getElementById('navAbout'),
      navServices: document.getElementById('navServices'),
      navContact: document.getElementById('navContact'),
      modalAbout: document.getElementById('modalAbout'),
      modalServices: document.getElementById('modalServices'),
      modalContact: document.getElementById('modalContact'),
      fakeInstall: document.getElementById('fakeInstall'),
      progressBar: document.getElementById('progressBar'),
      installTitle: document.getElementById('installTitle'),
      installMsg: document.getElementById('installMsg')
    };

    function emailOK(v){
      const email=(v||'').trim().toLowerCase();
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    function validateEmailField(){
      els.startBtn.disabled = !emailOK(els.playerEmail.value);
    }
    els.playerEmail.addEventListener('input', validateEmailField);

    function clampCount(max){
      const raw=String(els.count.value||'').replace(/[^0-9]/g,'');
      let n=parseInt(raw,10); if(isNaN(n)||n<1) n=1; if(max) n=Math.min(n,max);
      els.count.value=String(n); return n;
    }

    function startTimer(){
      clearInterval(timerInterval); state.timer = 180; updateTimer();
      timerInterval = setInterval(()=>{
        state.timer--; updateTimer();
        if(state.timer<=0){ clearInterval(timerInterval); finishQuiz(); }
      },1000);
    }
    function updateTimer(){
      const m=Math.floor(state.timer/60), s=state.timer%60;
      els.timer.textContent = `Czas: ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function renderQuestion(){
      const q = state.pool[state.current];
      els.qText.textContent = q.text;
      els.answers.innerHTML = '';
      els.explanation.textContent = '';
      els.qIndex.textContent = state.current+1;
      els.qTotal.textContent = state.pool.length;
      els.bar.style.width = ((state.current/state.pool.length)*100)+'%';

      // dots
      els.dots.innerHTML = '';
      state.pool.forEach((_,i)=>{
        const d=document.createElement('div');
        d.className='dot'+(i===state.current?' active':'');
        d.onclick=()=>{state.current=i; renderQuestion();};
        els.dots.appendChild(d);
      });

      // image
      if(q.image){
        els.qImage.style.display='block';
        els.qImage.src=q.image;
        els.qImage.alt=q.imageAlt||'Grafika do pytania';
        els.qImageCap.textContent=q.imageAlt||'';
        els.qImage.onerror=()=>{ els.qImage.removeAttribute('src'); els.qImage.style.display='none'; els.qImageCap.textContent='Miejsce na grafikę (opcjonalnie)'; };
      } else {
        els.qImage.removeAttribute('src'); els.qImage.style.display='none';
        els.qImageCap.textContent='Miejsce na grafikę (opcjonalnie)';
      }

      // options
      q.options.forEach((opt,idx)=>{
        const btn=document.createElement('button'); btn.className='option'; btn.textContent=opt;
        btn.onclick=()=>selectAnswer(idx);
        els.answers.appendChild(btn);
      });

      // restore selection
      const prev = state.answers[state.current];
      if(prev){
        [...els.answers.children].forEach((b,i)=>{
          if(i===q.correct) b.classList.add('correct');
          if(prev.choice===i && !prev.correct) b.classList.add('wrong');
          b.disabled = true;
        });
        els.explanation.textContent = q.why || '';
      }
    }

    function selectAnswer(idx){
      const q = state.pool[state.current];
      const correct = idx===q.correct;
      state.answers[state.current] = { choice: idx, correct };
      [...els.answers.children].forEach((b,i)=>{
        b.disabled=true;
        if(i===q.correct) b.classList.add('correct');
        if(i===idx && !correct) b.classList.add('wrong');
      });
      els.explanation.textContent = q.why || '';
      saveProgress();
    }

    function next(){ if(state.current<state.pool.length-1){ state.current++; renderQuestion(); } else { finishQuiz(); } }
    function prev(){ if(state.current>0){ state.current--; renderQuestion(); } }

    function finishQuiz(){
      clearInterval(timerInterval);
      const good = state.answers.filter(a=>a&&a.correct).length;
      els.quiz.style.display='none';
      els.result.style.display='block';
      els.score.textContent = `Wynik: ${good}/${state.pool.length}`;
      // zapis historii (lokalnie)
      const elapsed = 180 - state.timer;
      const resultObj = {
        email: els.playerEmail.value.trim().toLowerCase(),
        score: good, total: state.pool.length, seconds: elapsed,
        date: new Date().toLocaleString()
      };
      const hist = JSON.parse(localStorage.getItem('quizHistory') || '[]');
      hist.push(resultObj);
      localStorage.setItem('quizHistory', JSON.stringify(hist));
      localStorage.removeItem('quizProgress');
    }

    function startQuiz(){
      const email = els.playerEmail.value.trim().toLowerCase();
      if(!emailOK(email)) return;
      localStorage.setItem('quizUserEmail', email);

      const cat = els.category.value;
      const limitPerLevel = 10;
      const maxForCat = cat==='mix'
        ? Math.min(limitPerLevel*3, questions.latwe.length + questions.srednie.length + questions.trudne.length)
        : Math.min(limitPerLevel, questions[cat].length);
      els.count.max = String(maxForCat || 10);
      const cnt = clampCount(maxForCat || 10);

      let pool=[];
      if(cat==='mix'){
        pool=[...questions.latwe.slice(0,limitPerLevel),
              ...questions.srednie.slice(0,limitPerLevel),
              ...questions.trudne.slice(0,limitPerLevel)];
        pool = pool.slice(0,cnt);
      } else {
        pool=[...questions[cat]].slice(0,cnt);
      }

      state={pool,current:0,answers:new Array(pool.length),timer:180};
      els.settings.style.display='none';
      els.quiz.style.display='block';
      els.result.style.display='none';
      renderQuestion(); startTimer(); saveProgress();
    }

    function saveProgress(){ localStorage.setItem('quizProgress', JSON.stringify({state})); }
    function loadProgress(){
      const data=localStorage.getItem('quizProgress');
      if(data){
        try{
          const saved=JSON.parse(data).state;
          if(saved && saved.pool && saved.pool.length){
            state=saved; els.settings.style.display='none'; els.quiz.style.display='block';
            renderQuestion(); startTimer();
          }
        }catch{}
      }
    }

    // events
    document.getElementById('startBtn').onclick=startQuiz;
    document.getElementById('nextBtn').onclick=next;
    document.getElementById('prevBtn').onclick=prev;
    document.getElementById('retryBtn').onclick=()=>{ localStorage.removeItem('quizProgress'); location.reload(); };

    // dopasowanie max count przy zmianie kategorii
    els.category.addEventListener('change', ()=>{
      const cat=els.category.value, limit=10;
      const maxForCat = cat==='mix'
        ? Math.min(limit*3, (questions.latwe?.length||0)+(questions.srednie?.length||0)+(questions.trudne?.length||0))
        : Math.min(limit, (questions[cat]||[]).length);
      els.count.max = String(maxForCat||10);
      clampCount(maxForCat||10);
    });
    els.count.addEventListener('input', ()=> clampCount(parseInt(els.count.max,10)||10) );

    // ładowanie pytań
    fetch('assets/questions.json')
      .then(r=>{ if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
      .then(d=>{
        questions=d;
        const savedEmail = localStorage.getItem('quizUserEmail') || '';
        if(savedEmail) els.playerEmail.value=savedEmail;
        validateEmailField();
        loadProgress();
      })
      .catch(()=>{ /* brak toasta – cicho failujemy */ });

    /* ======= Symulacja instalacji – 1x na sesję ======= */
    window.addEventListener('load', ()=>{
      if(!sessionStorage.getItem('fakeInstallShown')){
        const modal = els.fakeInstall;
        const bar = els.progressBar;
        const title = els.installTitle;
        const msg = els.installMsg;

        modal.classList.add('show');
        document.body.classList.add('no-scroll');

        let progress = 0;
        const interval = setInterval(()=>{
          progress += 5 + Math.random()*10; // pseudo-realny skok
          if(progress >= 100){
            progress = 100;
            clearInterval(interval);
            bar.style.width = '100%';
            title.textContent = 'To była symulacja testu bezpieczeństwa';
            msg.innerHTML = 'Nic się nie zainstalowało.<br>To element szkoleniowy – możesz kontynuować.';
            setTimeout(()=>{
              modal.classList.remove('show');
              document.body.classList.remove('no-scroll');
              sessionStorage.setItem('fakeInstallShown','1');
            }, 2500);
          } else {
            bar.style.width = progress + '%';
          }
        }, 180);
      }
    });

    /* ======= Modale edukacyjne – O nas / Usługi / Kontakt ======= */
    function openModal(el){ document.body.classList.add('no-scroll'); el.classList.add('show'); }
    function closeModal(el){ el.classList.remove('show'); document.body.classList.remove('no-scroll'); }

    els.navAbout.onclick   = ()=>openModal(els.modalAbout);
    els.navServices.onclick= ()=>openModal(els.modalServices);
    els.navContact.onclick = ()=>openModal(els.modalContact);

    document.querySelectorAll('[data-close]').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const sel = e.currentTarget.getAttribute('data-close');
        const m = document.querySelector(sel);
        if(m) closeModal(m);
      });
    });

    // zamknięcie modala po kliknięciu tła (poza kartą)
    [els.modalAbout, els.modalServices, els.modalContact, els.fakeInstall].forEach(m=>{
      m.addEventListener('click', (e)=>{ if(e.target===m && m.id!=='fakeInstall') closeModal(m); });
    });
  </script>
</body>
</html>
