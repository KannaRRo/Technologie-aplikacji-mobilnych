<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SecCoach – Quiz szkoleniowy</title>
  <style>
    :root {
      --bg: #0f172a;          /* slate-900 */
      --panel: #111827;       /* gray-900 */
      --muted: #94a3b8;       /* slate-400 */
      --text: #e5e7eb;        /* gray-200 */
      --accent: #38bdf8;      /* sky-400 */
      --accent-2: #34d399;    /* emerald-400 */
      --danger: #f43f5e;      /* rose-500 */
      --warn: #f59e0b;        /* amber-500 */
      --card: #0b1220;        /* deep panel */
      --border: #1f2937;      /* gray-800 */
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: radial-gradient(1200px 600px at 80% -10%, rgba(56,189,248,.12), transparent),
                              radial-gradient(800px 400px at -10% 120%, rgba(52,211,153,.12), transparent), var(--bg);
      color: var(--text); font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, Ubuntu, 'Helvetica Neue', Arial, "Noto Sans", sans-serif;
    }
    header {
      max-width: 1100px; margin: 24px auto 0; padding: 16px 20px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo {
      width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: var(--shadow);
    }
    .brand h1 { margin:0; font-size: clamp(18px, 2.2vw, 22px); letter-spacing:.3px; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 20px 48px; }

    .grid { display:grid; grid-template-columns: 1.1fr .9fr; gap: 22px; }
    @media (max-width: 960px) { .grid { grid-template-columns: 1fr; } }

    .panel { background: rgba(255,255,255,.02); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
    .panel h2 { margin:0 0 14px; font-size: 18px; color: var(--text); }

    .settings { padding: 18px; position: sticky; top: 16px; }
    .row { display:flex; gap:12px; align-items:center; margin: 10px 0; }
    label { color: var(--muted); font-size: 14px; }
    select, input[type="number"], button, .btn {
      appearance:none; border: 1px solid var(--border); background: var(--card); color: var(--text);
      padding: 10px 12px; border-radius: 12px; font-weight: 600; letter-spacing:.2px;
    }
    select, input[type="number"] { width: 100%; }
    .switch { display:inline-flex; gap:8px; align-items:center; cursor:pointer; user-select:none; }
    .switch input { display:none; }
    .switch .track { width: 44px; height: 24px; background: #1f2937; border-radius: 999px; position:relative; border:1px solid var(--border); }
    .switch .thumb { position:absolute; top:2px; left:2px; width: 18px; height: 18px; background:#e5e7eb; border-radius:50%; transition:.2s; }
    .switch input:checked + .track .thumb { transform: translateX(20px); background: white; }

    .quiz { padding: 18px; }

    .card { background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--border); border-radius: var(--radius); padding: 18px; box-shadow: var(--shadow); }
    .meta { display:flex; justify-content:space-between; align-items:center; color: var(--muted); font-size: 14px; margin-bottom: 14px; }
    .progress { height: 8px; background:#0b1220; border:1px solid var(--border); border-radius:999px; overflow:hidden; }
    .bar { height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width .25s ease; }

    .q-img { width: 100%; height: clamp(160px, 28vw, 260px); border:1px dashed var(--border); border-radius: 14px; display:grid; place-items:center; color: var(--muted); background: #0b1220; overflow:hidden; margin: 10px 0 14px; }
    .q-img img { width:100%; height:100%; object-fit:cover; display:none; }

    .q-text { font-size: clamp(18px, 2.2vw, 22px); margin: 8px 0 14px; }

    .answers { display:grid; grid-template-columns: 1fr; gap: 10px; }
    .option { border:1px solid var(--border); background: #0e1627; border-radius: 12px; padding: 12px 14px; cursor:pointer; text-align:left; }
    .option:hover { border-color: #334155; }
    .option[aria-checked="true"] { outline: 2px solid var(--accent); }
    .option.correct { border-color: rgba(52,211,153,.8); background: rgba(52,211,153,.08); }
    .option.wrong { border-color: rgba(244,63,94,.8); background: rgba(244,63,94,.08); }

    .controls { display:flex; gap: 10px; margin-top: 14px; flex-wrap: wrap; }
    .btn { display:inline-flex; align-items:center; gap:8px; }
    .primary { background: linear-gradient(135deg, var(--accent), var(--accent-2)); border: none; color: #0b1220; }
    .ghost { background: transparent; }

    .hidden { display:none !important; }

    .results { padding: 18px; }
    .score { font-size: 20px; margin-bottom: 10px; }
    .review { display:grid; gap: 10px; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding: 3px 10px; border-radius: 999px; background:#0b1220; border:1px solid var(--border); color: var(--muted); font-size: 12px; }
    .tag { color:#0ea5e9; font-weight:700; font-size: 11px; background: rgba(14,165,233,.12); border:1px solid rgba(14,165,233,.25); }

    footer { max-width: 1100px; margin: 24px auto; padding: 0 20px; color: var(--muted); font-size: 12px; }
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>
</head>
<body>
  <header>
    <div class="brand" aria-label="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>SecCoach – interaktywny quiz szkoleniowy</h1>
    </div>
    <label class="switch" title="Tryb wysoki kontrast (jasny/ciemny)">
      <input id="themeToggle" type="checkbox" />
      <span class="track"><span class="thumb"></span></span>
      <span aria-hidden="true" class="sr-only">Przełącz motyw</span>
    </label>
  </header>

  <main class="container">
    <div class="grid">
      <!-- USTAWIENIA / PANEL STARTOWY -->
      <section class="panel settings" aria-label="Ustawienia">
        <h2>Ustawienia quizu</h2>
        <div class="row">
          <label for="category">Kategoria pytań</label>
          <select id="category">
            <option value="magazyn">Łatwe – magazyn</option>
            <option value="sprzedaz">Średnie – sprzedaż</option>
            <option value="kadra">Zaawansowane – kadra</option>
            <option value="mix">Miks losowy (wszystkie)</option>
          </select>
        </div>
        <div class="row">
          <label for="count">Liczba pytań</label>
          <input id="count" type="number" min="1" max="30" value="10" />
        </div>
        <div class="row">
          <label class="switch"><input id="shuffle" type="checkbox" checked /><span class="track"><span class="thumb"></span></span>Losuj kolejność</label>
        </div>
        <div class="row">
          <button id="startBtn" class="btn primary" style="width:100%">Rozpocznij quiz</button>
        </div>
        <hr style="border-color: var(--border); opacity:.5; margin: 14px 0;">
        <p style="color:var(--muted); font-size:14px; margin:0">
          <strong>Uwaga:</strong> pytania i grafiki są na razie zastąpione <em>lorem ipsum</em>. W miejscach oznaczonych komentarzem <code>// TODO</code> wstawisz docelowe treści i obrazy.
        </p>
      </section>

      <!-- OBSZAR QUIZU -->
      <section class="panel quiz" aria-live="polite" aria-atomic="true">
        <div id="quizView" class="card">
          <!-- Meta / postęp -->
          <div class="meta">
            <div>
              <span class="pill">Pytanie <span id="qIndex">0</span>/<span id="qTotal">0</span></span>
              <span class="pill tag" id="qTag">KATEGORIA</span>
            </div>
            <div style="min-width: 180px;">
              <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
            </div>
          </div>

          <!-- Obrazek pytania (placeholder) -->
          <figure class="q-img" id="qImageBox">
            <img id="qImage" alt="Obraz ilustrujący pytanie" />
            <figcaption id="qImageCap">Miejsce na grafikę (opcjonalnie)</figcaption>
          </figure>

          <!-- Treść pytania -->
          <div id="qText" class="q-text">Kliknij „Rozpocznij quiz”, aby zacząć.</div>

          <!-- Odpowiedzi -->
          <div id="answers" class="answers"></div>

          <!-- Sterowanie -->
          <div class="controls">
            <button id="prevBtn" class="btn ghost" disabled>Wstecz</button>
            <button id="nextBtn" class="btn">Dalej</button>
            <button id="finishBtn" class="btn" style="margin-left:auto;">Zakończ</button>
          </div>
        </div>

        <!-- WIDOK WYNIKÓW -->
        <div id="resultsView" class="results hidden">
          <div class="score" id="scoreText">Wynik: 0/0</div>
          <div class="row" style="gap:8px; flex-wrap:wrap;">
            <button id="retryBtn" class="btn">Zagraj ponownie</button>
            <button id="exportBtn" class="btn ghost">Eksport do CSV</button>
          </div>
          <h3 style="margin-top:16px;">Przegląd pytań</h3>
          <div id="review" class="review"></div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <p>© <span id="year"></span> SecCoach. Szablon quizu – gotowy na podmianę treści i grafik.</p>
  </footer>

  <script>
    // ====== DANE PRZYKŁADOWE (LOREM IPSUM) ======
    // Każde pytanie może opcjonalnie mieć: image: "ścieżka/do/obrazu.jpg" oraz imageAlt.
    const BANK = {
      magazyn: [
        {
          id: 'm1',
          tag: 'Łatwe',
          text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit?',
          image: '', // TODO: np. 'img/magazyn-1.jpg'
          imageAlt: 'Opis obrazu do dostępności',
          options: ['Lorem', 'Ipsum', 'Dolor', 'Sit amet'],
          correct: 1,
        },
        {
          id: 'm2', tag: 'Łatwe',
          text: 'Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua?',
          image: '', options: ['Tempor', 'Incididunt', 'Ut', 'Labore'], correct: 3,
        },
        {
          id: 'm3', tag: 'Łatwe',
          text: 'Ut enim ad minim veniam, quis nostrud exercitation ullamco?',
          image: '', options: ['Ut enim', 'Ad minim', 'Veniam', 'Nostrud'], correct: 0,
        },
      ],
      sprzedaz: [
        { id:'s1', tag:'Średnie', text:'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum?', image:'', options:['Duis','Aute','Irure','Dolor'], correct:2 },
        { id:'s2', tag:'Średnie', text:'Excepteur sint occaecat cupidatat non proident?', image:'', options:['Excepteur','Sint','Occaecat','Cupidatat'], correct:0 },
        { id:'s3', tag:'Średnie', text:'Sunt in culpa qui officia deserunt mollit anim id est laborum?', image:'', options:['Sunt','In culpa','Qui officia','Deserunt'], correct:1 },
      ],
      kadra: [
        { id:'k1', tag:'Zaawansowane', text:'Curabitur non nulla sit amet nisl tempus convallis quis ac lectus?', image:'', options:['Curabitur','Non nulla','Sit amet','Nisl'], correct:3 },
        { id:'k2', tag:'Zaawansowane', text:'Praesent sapien massa, convallis a pellentesque nec, egestas non nisi?', image:'', options:['Praesent','Sapien','Massa','Convallis'], correct:1 },
        { id:'k3', tag:'Zaawansowane', text:'Vestibulum ac diam sit amet quam vehicula elementum sed sit amet dui?', image:'', options:['Vestibulum','Ac diam','Sit amet','Quam'], correct:0 },
      ]
    };

    // ====== STAN APLIKACJI ======
    const state = {
      pool: [],
      current: 0,
      answers: [], // { choice, correct }
      started: false,
    };

    // ====== ELEMENTY DOM ======
    const els = {
      themeToggle: document.getElementById('themeToggle'),
      category: document.getElementById('category'),
      count: document.getElementById('count'),
      shuffle: document.getElementById('shuffle'),
      startBtn: document.getElementById('startBtn'),

      quizView: document.getElementById('quizView'),
      resultsView: document.getElementById('resultsView'),

      qIndex: document.getElementById('qIndex'),
      qTotal: document.getElementById('qTotal'),
      qTag: document.getElementById('qTag'),
      qText: document.getElementById('qText'),
      answers: document.getElementById('answers'),
      qImage: document.getElementById('qImage'),
      qImageBox: document.getElementById('qImageBox'),
      qImageCap: document.getElementById('qImageCap'),

      bar: document.getElementById('bar'),

      prevBtn: document.getElementById('prevBtn'),
      nextBtn: document.getElementById('nextBtn'),
      finishBtn: document.getElementById('finishBtn'),

      scoreText: document.getElementById('scoreText'),
      review: document.getElementById('review'),
      retryBtn: document.getElementById('retryBtn'),
      exportBtn: document.getElementById('exportBtn'),
    };

    // ====== POMOCNICZE ======
    const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    function shuffleArray(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

    function buildPool(category, count, doShuffle){
      let pool = [];
      if(category === 'mix') pool = [...BANK.magazyn, ...BANK.sprzedaz, ...BANK.kadra];
      else pool = [...BANK[category]];
      if(doShuffle) shuffleArray(pool);
      return pool.slice(0, Math.min(count, pool.length));
    }

    function renderQuestion(){
      const q = state.pool[state.current];
      els.qIndex.textContent = state.current + 1;
      els.qTotal.textContent = state.pool.length;
      els.qTag.textContent = q.tag || '';

      els.qText.textContent = q.text;

      // Obrazek (placeholder, jeśli brak ścieżki)
      if(q.image){
        els.qImage.src = q.image;
        els.qImage.alt = q.imageAlt || 'Grafika do pytania';
        els.qImage.style.display = 'block';
        els.qImageCap.textContent = q.imageAlt || '';
      } else {
        els.qImage.removeAttribute('src');
        els.qImage.style.display = 'none';
        els.qImageCap.textContent = 'Miejsce na grafikę (opcjonalnie)';
      }

      // Odpowiedzi
      els.answers.innerHTML = '';
      q.options.forEach((opt, idx)=>{
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.setAttribute('role','radio');
        btn.setAttribute('aria-checked','false');
        btn.innerHTML = `<strong>${String.fromCharCode(65+idx)}.</strong> ${opt}`;
        btn.addEventListener('click', ()=>selectAnswer(idx));
        // Jeśli już zaznaczono wcześniej, odtwórz stan
        const saved = state.answers[state.current];
        if(saved){
          const checked = saved.choice === idx;
          btn.setAttribute('aria-checked', checked ? 'true':'false');
          if(saved.reveal){
            btn.classList.toggle('correct', idx === q.correct);
            btn.classList.toggle('wrong', checked && idx !== q.correct);
          }
        }
        els.answers.appendChild(btn);
      });

      // Postęp
      const progress = ((state.current) / state.pool.length) * 100;
      els.bar.style.width = `${progress}%`;

      // Przyciski
      els.prevBtn.disabled = state.current === 0;
      els.nextBtn.disabled = state.current >= state.pool.length - 1;
    }

    function selectAnswer(idx){
      const q = state.pool[state.current];
      state.answers[state.current] = { choice: idx, correct: idx === q.correct };
      // ARIA / zaznaczenie
      [...els.answers.children].forEach((el, i)=>{
        el.setAttribute('aria-checked', i===idx ? 'true' : 'false');
      });
    }

    function finishQuiz(){
      // Odsłoń poprawne/wrong w widoku pytań
      state.answers = state.answers.map((a, i)=> a ? {...a, reveal:true} : { choice:null, correct:false, reveal:true });
      const q = state.pool[state.current];
      [...els.answers.children].forEach((el, i)=>{
        el.classList.toggle('correct', i===q.correct);
        if(state.answers[state.current]?.choice === i && i!==q.correct) el.classList.add('wrong');
      });

      // Wynik
      const good = state.answers.filter(a=>a && a.correct).length;
      els.scoreText.textContent = `Wynik: ${good}/${state.pool.length}`;

      // Przegląd
      els.review.innerHTML = '';
      state.pool.forEach((qq, i)=>{
        const a = state.answers[i];
        const item = document.createElement('div');
        item.className = 'card';
        item.innerHTML = `
          <div class="meta">
            <span class="pill">#${i+1}</span>
            <span class="pill ${a?.correct ? 'tag' : ''}">${a?.correct ? 'POPRAWNIE' : 'BŁĄD'}</span>
          </div>
          <div style="font-weight:600; margin-bottom:6px;">${qq.text}</div>
          <div style="font-size:14px; color:var(--muted);">Poprawna: <strong>${String.fromCharCode(65+qq.correct)}</strong> – ${qq.options[qq.correct]}</div>
          ${a && a.choice!=null ? `<div style="font-size:13px; color:${a.correct ? 'var(--accent-2)' : 'var(--danger)'};">Twoja odpowiedź: <strong>${String.fromCharCode(65+a.choice)}</strong> – ${qq.options[a.choice]}</div>` : '<div style="font-size:13px; color:var(--warn);">Brak odpowiedzi</div>'}
        `;
        els.review.appendChild(item);
      });

      els.quizView.classList.add('hidden');
      els.resultsView.classList.remove('hidden');
    }

    function exportCSV(){
      const rows = [['#','Kategoria','Pytanie','Poprawna (litera)','Poprawna (treść)','Twoja (litera)','Twoja (treść)','Wynik']];
      state.pool.forEach((q, i)=>{
        const a = state.answers[i];
        const correctL = String.fromCharCode(65 + q.correct);
        const yourL = a && a.choice!=null ? String.fromCharCode(65+a.choice) : '';
        rows.push([
          i+1,
          q.tag || '',
          q.text.replaceAll('\n',' '),
          correctL,
          q.options[q.correct],
          yourL,
          a && a.choice!=null ? q.options[a.choice] : '',
          a && a.correct ? '1' : '0'
        ]);
      });
      const csv = rows.map(r=> r.map(cell=>`"${String(cell).replaceAll('"','""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'wyniki_quizu.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // ====== ZDARZENIA / LOGIKA APLIKACJI ======
    function startQuiz(){
      const cat = els.category.value;
      const cnt = parseInt(els.count.value, 10) || 10;
      const pool = buildPool(cat, cnt, els.shuffle.checked);
      state.pool = pool;
      state.current = 0;
      state.answers = new Array(pool.length);
      state.started = true;
      els.resultsView.classList.add('hidden');
      els.quizView.classList.remove('hidden');
      renderQuestion();
    }

    function next(){ if(state.current < state.pool.length - 1){ state.current++; renderQuestion(); } }
    function prev(){ if(state.current > 0){ state.current--; renderQuestion(); } }

    // Motyw (prosty toggle – w razie potrzeby można dodać jasną paletę)
    els.themeToggle.addEventListener('change', ()=>{
      document.body.style.filter = els.themeToggle.checked ? 'invert(1) hue-rotate(180deg)' : 'none';
    });

    // Hooki UI
    els.startBtn.addEventListener('click', startQuiz);
    els.nextBtn.addEventListener('click', next);
    els.prevBtn.addEventListener('click', prev);
    els.finishBtn.addEventListener('click', finishQuiz);
    els.retryBtn.addEventListener('click', ()=>{
      els.resultsView.classList.add('hidden');
      els.quizView.classList.remove('hidden');
      startQuiz();
    });
    els.exportBtn.addEventListener('click', exportCSV);

    // Init
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
